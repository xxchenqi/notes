# 工作中遇到的问题

### 网校崩溃原因:

```
更新dexguard后导致崩溃异常(实际原因是protobuf库老板本中存在的隐患)

崩溃信息：
java.lang.IllegalAccessException
Class java.lang.Class<com.google.protobuf.GeneratedMessageLite> cannot access private method void com.hujiang.pb.PacketBase$Packet.getConnTimeout() of class java.lang.Class<com.hujiang.pb.PacketBase$Packet>

崩溃问题分析：
dexguard混淆后将
private void clearMiscResponse() 
修改为
private void getConnTimeout()

在google的protobuf库中：
MessageLiteToString.toString方法会强制反射执行getXXX方法,并且未检查是否是Public权限，故出现崩溃异常

在新版本protobuf库中修复了此问题。

修复手段：
1.不混淆PacketBase 
2.CC升级protobuf库
```



### Android 8.0 解决 Only fullscreen opaque activities can request orientation

```
原因是我们给Activity同时设置了 android:screenOrientation="" 和 <item name="android:windowIsTranslucent">true</item>。

解决：
在values-v26目录下，新建styles.xml做一个适配


或者
（推荐）移除manifest文件里的screenOrientation属性，并在Activity的onCreate方法里设置屏幕方向

if (Build.VERSION.SDK_INT != Build.VERSION_CODES.O) {
	setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);
}
```





### 瀑布流分割线

```kotlin
class SquareItemDecoration(space: Int) :
    RecyclerView.ItemDecoration() {
    private var space = 0
    private var pos = 0
    override fun getItemOffsets(
        outRect: Rect,
        view: View,
        parent: RecyclerView,
        state: RecyclerView.State
    ) {
        pos = parent.getChildAdapterPosition(view)
        if (pos == 0) return
        val params = view.layoutParams as StaggeredGridLayoutManager.LayoutParams
        outRect.top = space
        if (params.spanIndex % 2 == 0) {
            outRect.left = space
            outRect.right = space / 2
        } else {
            outRect.left = space / 2
            outRect.right = space
        }
    }

    init {
        this.space = space
    }
}
```



### 打包问题：

R8: java.lang.OutOfMemoryError: GC overhead limit exceeded

```
org.gradle.jvmargs=-Xmx4096m -XX:MaxPermSize=4096m -XX:+HeapDumpOnOutOfMemoryError
```



### 腾讯视频无法播放问题

关闭didi的网络插件。

原理：hook了HttpUrlConnection



### LiveData问题

和LoadSir一起用时，register中会发送handler，设置默认callback事件，

使用setValue,设置完成刷新界面后，收到了handler，设置默认callback事件，进行设置,导致加载完成后又回到了loading。
